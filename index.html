<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sync Metronome</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="page">
      <header class="hero">
        <div>
          <p class="eyebrow">LAN WebRTC Metronome</p>
          <h1>Stay on the same beat</h1>
          <p class="lede">
            Host in your browser, share a room code on the same Wi‑Fi, and keep visual + audio ticks in sync.
          </p>
        </div>
        <div class="pill">Dev server only; no external hosting needed.</div>
      </header>

      <section class="panel">
        <div class="field-row">
          <label for="room">Room</label>
          <input id="room" type="text" placeholder="e.g. rehearsal1" />
          <button id="connect">Connect</button>
          <button id="disconnect" class="ghost">Disconnect</button>
        </div>
        <div class="status">
          <span id="connectionStatus">Disconnected</span>
          <span id="leaderStatus">—</span>
          <span id="offsetStatus">Offset: —</span>
          <span id="syncStatus">Sync: —</span>
        </div>
        <div class="leader-row">
          <button id="becomeLeader" class="ghost">Become leader</button>
          <span class="muted">Leader is fixed to the room hub (first device). To change leader, reconnect and join first.</span>
        </div>
        <div class="share-row">
          <label for="shareUrl">Share this URL on Wi‑Fi</label>
          <input id="shareUrl" type="text" readonly />
          <button id="copyUrl" class="ghost">Copy</button>
        </div>
        <div class="field-grid">
          <label>BPM <input id="bpm" type="number" min="30" max="240" value="100" /></label>
          <label>Beats/Bar <input id="beats" type="number" min="1" max="12" value="4" /></label>
          <label>Lead-in (ms) <input id="leadIn" type="number" min="0" max="4000" value="400" /></label>
        </div>
        <div class="controls">
          <button id="calibrate">Calibrate</button>
          <button id="start" disabled>Start</button>
          <button id="stop" class="ghost">Stop</button>
          <button id="tapBtn" class="ghost">Tap</button>
          <label class="inline">
            <input id="mute" type="checkbox" />
            Mute clicks
          </label>
        </div>
        <div class="peers">
          Peers: <span id="peers">0</span>
        </div>
      </section>

      <section class="panel">
        <h2>Visual tick</h2>
        <div id="meter" class="meter"></div>
      </section>

      <section class="panel">
        <h2>How to Use (English)</h2>
        <ol>
          <li><strong>Connect to a Room:</strong> Enter a unique room name and click "Connect". Share the same room name with your friends on the same Wi-Fi network.</li>
          <li><strong>Become the Leader:</strong> The first person to join a room becomes the leader (room hub). Only the leader can start, stop, or change the tempo. To change leader, have everyone disconnect and let the new leader join first.</li>
          <li><strong>Set the Tempo:</strong> The leader can set the BPM (Beats Per Minute) and the time signature (Beats/Bar).</li>
          <li><strong>Calibrate (Important for Followers):</strong> Before starting, all followers should wait for the "Calibrate" button to become enabled and then click it. This synchronizes the clocks with the leader for tight timing. The leader can also calibrate to ensure the timing is set correctly.</li>
          <li><strong>Start the Metronome:</strong> Once everyone is connected and calibrated, the leader can click "Start". There will be a short lead-in before the first beat to ensure all devices start together.</li>
          <li><strong>Stopping:</strong> Only the leader can stop the metronome for everyone by clicking "Stop".</li>
        </ol>

        <h2>사용법 (Korean)</h2>
        <ol>
          <li><strong>방에 연결:</strong> 고유한 방 이름을 입력하고 "연결"을 클릭하세요. 동일한 Wi-Fi 네트워크에 있는 친구들과 같은 방 이름을 공유하세요.</li>
          <li><strong>리더 되기:</strong> 방에 처음 참여한 사람이 자동으로 리더(허브)가 됩니다. 리더만이 메트로놈을 시작, 중지하거나 템포를 변경할 수 있습니다. 리더를 바꾸려면 모두 연결을 끊고 새 리더가 먼저 접속하세요.</li>
          <li><strong>템포 설정:</strong> 리더는 BPM(분당 박자 수)과 박자표(마디당 박자 수)를 설정할 수 있습니다.</li>
          <li><strong>캘리브레이션 (팔로워에게 중요):</strong> 시작하기 전에 모든 팔로워는 "캘리브레이션" 버튼이 활성화될 때까지 기다렸다가 클릭해야 합니다. 이는 정확한 타이밍을 위해 시계를 리더와 동기화합니다. 리더도 타이밍이 정확하게 설정되었는지 확인하기 위해 캘리브레이션할 수 있습니다.</li>
          <li><strong>메트로놈 시작:</strong> 모든 사람이 연결되고 캘리브레이션되면 리더는 "시작"을 클릭할 수 있습니다. 모든 장치가 동시에 시작되도록 첫 박자 전에 짧은 리드인(lead-in)이 있습니다.</li>
          <li><strong>중지:</strong> 리더만이 "중지"를 클릭하여 모든 사람을 위한 메트로놈을 중지할 수 있습니다.</li>
        </ol>
      </section>
    </main>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="client.js"></script>
  </body>
</html>
